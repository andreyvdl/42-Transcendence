<!DOCTYPE html>
<html lang="BR">
	<head>
		<title>CASA</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" href="https://cdn.discordapp.com/icons/1237392612877533255/db9bd99ebc9fa3aaa33374b2f9e48f2e.webp" />

		<style>
			footer {
				text-align: center;
				padding: 3px;
				background-color: rgba(42, 42, 42, 0.3);
			}
		</style>
	</head>
	<body>
		<a href="/site/">TRANSCENDENCE</a>
		<h1 id="titulo">HOME</h1>
		<p id="descricao">Bem vindo ao transcendence</p>
		<div id="buttons">
			<a href="#login" id="btn_login">Login</a>
			<a href="#register" id="btn_register">Registre-se</a>
			<a href="#play" id="btn_play">Jogar</a>
		</div>
		<div id="formContainer"></div>
		<br>
	</body>
	<footer>
		<p>Feito com ‚å®Ô∏è, por Reinan, Fabio, (Luis) e Andrey</p>
	</footer>
	<script>
		window.addEventListener('hashchange', () => {
			const hash = window.location.hash;
			const buttons = document.querySelector('#buttons');

			if (hash === "#login" || hash === "#register")
				buttons.style.display = 'none';
			else
				buttons.style.display = 'block';

			const formContainer = document.querySelector('#formContainer');

			if (hash === "#login" || hash === "#register") {
				const form = document.createElement('form');
				const emailInput = document.createElement('input');
				const passInput = document.createElement('input');
				const submitBttn = document.createElement('button');

				form.addEventListener('submit', (event) => {
					const formData = new FormData(form);
					// const email = formData.get('email');
					// const password = formData.get('password');
					// const regex_password = [
					// 	/^(?=.*\d)/,
					// 	/^(?=.*[a-z])/,
					// 	/^(?=.*[A-Z])/,
					// 	/^(?=.*[@#$%^-_+])/,
					// 	/(?=.*[!&=\?,])/,
					// 	/(?=.*\s)/,
					// 	/.{8,16}/,
					// 	/(?=.*['"])/
					// ];
					// const regex_email = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/;

					// event.preventDefault();
					// if (!regex_email.test(email)) {
					// 	event.preventDefault();
					// 	alert('Email inv√°lido üìß');
					// 	return ;
					// } else if (!regex_password[0].test(password)) {
					// 	event.preventDefault();
					// 	alert('Senha deve conter ao menos um n√∫mero üíØ');
					// 	return ;
					// } else if (!regex_password[1].test(password)) {
					// 	event.preventDefault();
					// 	alert('Senha deve conter ao menos uma letra min√∫scula ü§è');
					// 	return ;
					// } else if (!regex_password[2].test(password)) {
					// 	event.preventDefault();
					// 	alert('Senha deve conter ao menos uma letra mai√∫scula üôå');
					// 	return ;
					// } else if (!regex_password[3].test(password)) {
					// 	event.preventDefault();
					// 	alert('Senha deve conter ao menos um caractere especial como `@#$%^-_+`');
					// 	return ;
					// } else if (regex_password[4].test(password)) {
					// 	event.preventDefault();
					// 	alert('Senha n√£o deve conter caracteres especiais "!&=?" üòá');
					// 	return ;
					// } else if (regex_password[5].test(password)) {
					// 	event.preventDefault();
					// 	alert('Senha n√£o deve conter espa√ßos üëæ');
					// 	return ;
					// } else if (!regex_password[6].test(password)) {
					// 	event.preventDefault();
					// 	alert('Senha deve conter entre 8 e 16 caracteres üîÅ');
					// 	return ;
					// } else if (regex_password[7].test(password)) {
					// 	event.preventDefault();
					// 	alert('üíâ de SQL n√£o √© legal! O FBI est√° indo para sua casa agora.');
					// 	return ;
					// }

					const data = Object.fromEntries(formData);

					data.newUser = (document.getElementById('register_form') ? true : false);
					if (data.newUser) {
						fetch('site/register.js', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify(data)
						})
						.then(response => console.log(response))
						.then(data => {
							if (data.error) {
								alert(data.error);
							} else {
								alert('Usu√°rio criado com sucesso!');
							}
						})
						.catch(error => {
							console.error('ERROU: ', error);
							alert('Erro ao conectar com o servidor');
						});
						window.location.href = '#login';
					}
					// else {
					// 	fetch('/site/login.js', {
					// 		method: 'GET',
					// 		headers: {
					// 			'Content-Type': 'application/json'
					// 		},
					// 		body: JSON.stringify(data)
					// 	})
					// 	.then(response => response.json())
					// 	.then(data => {
					// 		if (data.error) {
					// 			alert(data.error);
					// 		} else {
					// 			alert('Usu√°rio logado com sucesso!');
					// 		}
					// 	})
					// 	.catch(error => {
					// 		console.error('ERROU: ', error);
					// 		alert('Erro ao conectar com o servidor');
					// 	});
					// }
					// pdf p√°gina 7
					// const socket = new WebSocket('ws://localhost:3000/site');
					// const payload = {
					// 	email: email,
					// 	password: password,
					// 	newUser: (document.getElementById('register_form') ? true : false)
					// };
					// socket.onerror = (error) => {
					// 	console.error('ERROU: ', error);
					// 	alert('Erro ao conectar com o servidor');
					// };
					// socket.onopen = () => {
					// 	console.log('tamo abertos');
					// 	socket.send(JSON.stringify(payload));
					// };
				})
				emailInput.setAttribute('type', 'email');
				emailInput.setAttribute('autocomplete', 'on');
				emailInput.setAttribute('placeholder', 'Email');
				emailInput.setAttribute('name', 'email');
				passInput.setAttribute('type', 'password');
				passInput.setAttribute('placeholder', 'Password');
				passInput.setAttribute('name', 'password');
				passInput.setAttribute('autocomplete', 'on');
				submitBttn.setAttribute('type', 'submit');
				submitBttn.textContent = 'Submit';
				
				if (hash === "#login") {
					document.querySelector('#titulo').innerHTML = 'LOGIN';
					document.querySelector('#descricao').innerHTML =
						'N√£o tem uma conta? <a href="#register">Registre-se</a>';
					form.setAttribute('id', 'login_form');
					form.setAttribute('method', 'GET');
				}
				else if (hash === "#register") {
					document.querySelector('#titulo').innerHTML = 'REGISTER';
					document.querySelector('#descricao').innerHTML =
						'J√° tem uma conta? <a href="#login">Entre</a>';
					form.setAttribute('id', 'register_form');
					form.setAttribute('method', 'POST');
				}

				form.appendChild(emailInput);
				form.appendChild(document.createElement('br'));
				form.appendChild(passInput);
				form.appendChild(document.createElement('br'));
				form.appendChild(submitBttn);
				formContainer.innerHTML = '';
				formContainer.appendChild(form);
			} else if (hash === "#play") {
				document.querySelector('#titulo').innerHTML = 'PLAY';
				document.querySelector('#descricao').innerHTML =
					'Jogue transcendence';
				formContainer.innerHTML = '';
			} else {
				document.querySelector('#titulo').innerHTML = 'HOME';
				document.querySelector('#descricao').innerHTML =
					'Bem vindo ao transcendence';
				formContainer.innerHTML = '';
			}
		})
	</script>
</html>
